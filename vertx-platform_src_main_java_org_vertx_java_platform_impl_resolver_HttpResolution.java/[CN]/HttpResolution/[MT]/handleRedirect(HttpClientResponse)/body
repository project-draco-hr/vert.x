{
  String location=resp.headers().get("location");
  if (location == null) {
    log.error("HTTP redirect with no location header");
  }
 else {
    URI redirectURI;
    try {
      redirectURI=new URI(location);
      client.close();
      client=null;
      int redirectPort=redirectURI.getPort();
      if (redirectPort == -1) {
        redirectPort=80;
      }
      String uri=redirectURI.getRawPath();
      String query=redirectURI.getRawQuery();
      if (query != null) {
        uri=uri + "?" + query;
      }
      createClient(redirectURI.getScheme(),redirectURI.getHost(),redirectPort);
      makeRequest(redirectURI.getScheme(),redirectURI.getHost(),redirectPort,uri);
    }
 catch (    URISyntaxException e) {
      log.error("Invalid redirect URI: " + location);
    }
  }
}
