{
  handshaking=true;
  try {
    ChannelHandler handler=ctx.pipeline().get(HttpContentDecompressor.class);
    if (handler != null) {
      ctx.pipeline().remove(handler);
    }
    ws=new DefaultWebSocket(vertx,ClientConnection.this);
    handshaker.finishHandshake(channel,response);
    log.debug("WebSocket handshake complete");
    wsConnect.handle(ws);
  }
 catch (  WebSocketHandshakeException e) {
    client.handleException(e);
  }
}
