{
  Handler<Message<T>> theHandler=null;
synchronized (this) {
    if (paused) {
      if (pending.size() < maxBufferedMessages) {
        pending.add(message);
      }
 else {
        if (discardHandler != null) {
          discardHandler.handle(message);
        }
      }
    }
 else {
      checkNextTick();
      MessageImpl abc=(MessageImpl)message;
      metrics.beginHandleMessage(metric,abc.getSocket() == null);
      theHandler=handler;
    }
  }
  if (theHandler != null) {
    handleMessage(theHandler,message);
  }
}
