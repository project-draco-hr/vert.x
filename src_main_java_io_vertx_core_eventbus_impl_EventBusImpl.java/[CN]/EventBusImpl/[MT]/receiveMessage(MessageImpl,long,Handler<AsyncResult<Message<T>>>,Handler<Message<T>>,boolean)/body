{
  msg.setBus(this);
  Handlers handlers=handlerMap.get(msg.address());
  if (handlers != null) {
    if (msg.send()) {
      HandlerHolder holder=handlers.choose();
      if (holder != null) {
        metrics.messageReceived(msg.address(),!msg.send(),local,1);
        doReceive(msg,holder,local);
      }
    }
 else {
      metrics.messageReceived(msg.address(),!msg.send(),local,handlers.list.size());
      for (      HandlerHolder holder : handlers.list) {
        doReceive(msg,holder,local);
      }
    }
  }
 else {
    metrics.messageReceived(msg.address(),!msg.send(),local,0);
    if (replyHandler != null) {
      sendNoHandlersFailure(msg.address(),replyHandler);
      if (timeoutID != -1) {
        vertx.cancelTimer(timeoutID);
      }
      if (simpleReplyHandler != null) {
        unregisterHandler(msg.replyAddress(),simpleReplyHandler);
      }
    }
  }
}
