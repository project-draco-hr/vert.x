{
  if (parent.channelFuture.isDone()) {
    writeQuery(query);
  }
 else {
    parent.channelFuture.addListener(new GenericFutureListener<Future<? super Channel>>(){
      @Override public void operationComplete(      Future<? super Channel> future) throws Exception {
        if (future.isSuccess()) {
          writeQuery(query);
        }
 else {
          promise.tryFailure(future.cause());
        }
      }
    }
);
  }
}
