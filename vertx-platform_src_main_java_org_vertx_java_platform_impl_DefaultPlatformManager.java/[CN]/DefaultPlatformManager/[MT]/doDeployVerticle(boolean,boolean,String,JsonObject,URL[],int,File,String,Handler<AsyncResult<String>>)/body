{
  checkWorkerContext();
  if (main == null) {
    throw new NullPointerException("main cannot be null");
  }
  if (urls == null) {
    throw new IllegalStateException("deployment classpath for deploy is null");
  }
  String depName=genDepName();
  ModuleIdentifier enclosingModName=getEnclosingModID();
  String moduleKey;
  boolean loadFromModuleFirst;
  if (enclosingModName == null) {
    moduleKey=ModuleIdentifier.createInternalModIDForVerticle(depName).toString();
    loadFromModuleFirst=false;
  }
 else {
    moduleKey=enclosingModName.toString() + "#" + main;
    VerticleHolder holder=getVerticleHolder();
    Deployment dep=holder.deployment;
    loadFromModuleFirst=dep.loadFromModuleFirst;
  }
  ModuleReference mr=getModuleReference(moduleKey,urls,loadFromModuleFirst);
  if (enclosingModName != null) {
    ModuleReference parentRef=moduleRefs.get(enclosingModName.toString());
    if (mr.mcl.addReference(parentRef)) {
      parentRef.incRef();
    }
  }
  if (includes != null) {
    loadIncludedModules(modRoot,currentModDir,mr,includes);
  }
  doDeploy(depName,false,worker,multiThreaded,null,main,null,config,urls,instances,currentModDir,mr,modRoot,false,loadFromModuleFirst,doneHandler);
}
