{
  checkWorkerContext();
  for (  String moduleName : parseIncludeString(includesString)) {
    ModuleIdentifier modID=new ModuleIdentifier(moduleName);
    if (included.contains(modID.toString())) {
      log.warn("Module " + modID + " is included more than once in chain of includes");
    }
 else {
      included.add(modID.toString());
      ModuleReference includedMr=moduleRefs.get(moduleName);
      if (includedMr == null) {
        File modDir=locateModule(modRoot,currentModuleDir,modID);
        if (modDir == null) {
          doInstallMod(modID);
        }
        modDir=locateModule(modRoot,currentModuleDir,modID);
        ModuleInfo info=loadModuleInfo(modDir,modID);
        ModuleFields fields=new ModuleFields(info.modJSON);
        includedCP.addAll(info.cp);
        boolean res=fields.isResident();
        includedMr=new ModuleReference(this,moduleName,new ModuleClassLoader(modID.toString(),platformClassLoader,info.cp.toArray(new URL[info.cp.size()]),fields.isLoadFromModuleFirst()),res);
        ModuleReference prev=moduleRefs.putIfAbsent(moduleName,includedMr);
        if (prev != null) {
          includedMr=prev;
        }
        String includes=fields.getIncludes();
        if (includes != null) {
          doLoadIncludedModules(modRoot,modDir,includedMr,includes,included,includedCP);
        }
      }
      if (mr.mcl.addReference(includedMr)) {
        includedMr.incRef();
      }
    }
  }
}
