{
  Path top=Paths.get(topDir.getAbsolutePath());
  File[] files=dir.listFiles();
  byte[] buffer=new byte[4096];
  for (int i=0; i < files.length; i++) {
    Path entry=Paths.get(files[i].getAbsolutePath());
    Path rel=top.relativize(entry);
    String entryName=rel.toString();
    if (files[i].isDirectory()) {
      entryName+=FILE_SEP;
    }
    if (!files[i].isDirectory()) {
      out.putNextEntry(new ZipEntry(entryName));
      try (FileInputStream in=new FileInputStream(files[i])){
        int bytesRead;
        while ((bytesRead=in.read(buffer)) != -1) {
          out.write(buffer,0,bytesRead);
        }
      }
       out.closeEntry();
    }
    if (files[i].isDirectory()) {
      addDirToZip(topDir,files[i],out);
    }
  }
}
