{
  final Set<Deployment> parents=new HashSet<>();
  for (  Deployment dep : deps) {
    parents.add(getTopMostDeployment(dep));
  }
  runInBackground(new Runnable(){
    public void run(){
      for (      final Deployment deployment : parents) {
        if (deployments.containsKey(deployment.name)) {
          doUndeploy(deployment,new Handler<AsyncResult<Void>>(){
            public void handle(            AsyncResult<Void> res){
              if (res.succeeded()) {
                doRedeploy(deployment);
              }
 else {
                log.error("Failed to undeploy",res.cause());
              }
            }
          }
);
        }
 else {
          doRedeploy(deployment);
        }
      }
    }
  }
,null);
}
