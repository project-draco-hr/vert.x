{
  try (InputStream is=new BufferedInputStream(new FileInputStream(jarName));ZipInputStream zis=new ZipInputStream(new BufferedInputStream(is))){
    ZipEntry entry;
    while ((entry=zis.getNextEntry()) != null) {
      String entryName=entry.getName();
      if (!entryName.isEmpty()) {
        if (entry.isDirectory()) {
          if (!new File(directory,entryName).mkdir()) {
            throw new IllegalStateException("Failed to create directory");
          }
        }
 else {
          int count;
          byte[] buff=new byte[BUFFER_SIZE];
          BufferedOutputStream dest=null;
          try {
            File fentry=new File(directory,entryName);
            File dir=fentry.getParentFile();
            if (!dir.exists()) {
              dir.mkdirs();
            }
            OutputStream fos=new FileOutputStream(fentry);
            dest=new BufferedOutputStream(fos,BUFFER_SIZE);
            while ((count=zis.read(buff,0,BUFFER_SIZE)) != -1) {
              dest.write(buff,0,count);
            }
            dest.flush();
          }
  finally {
            if (dest != null) {
              dest.close();
            }
          }
        }
      }
    }
  }
 }
