{
  req.bodyHandler(new Handler<Buffer>(){
    public void handle(    Buffer buff){
      String msgs=buff.toString();
      if (msgs.equals("")) {
        req.response().setStatusCode(500);
        req.response().writeStringAndEnd("Payload expected.");
        return;
      }
      if (!session.handleMessages(msgs)) {
        sendInvalidJSON(req.response());
      }
 else {
        req.response().headers().set("Content-Type","text/plain; charset=UTF-8");
        setNoCacheHeaders(req);
        setJSESSIONID(config,req);
        setCORS(req);
        req.response().setStatusCode(204);
        req.response().end();
      }
      if (log.isTraceEnabled())       log.trace("XHR send processed ok");
    }
  }
);
}
