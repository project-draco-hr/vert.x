{
  final SockInfo info=sockInfos.get(sock);
  if (replyAddress != null && !checkMaxHandlers(info)) {
    return;
  }
  final Handler<AsyncResult<Message<Object>>> replyHandler;
  if (replyAddress != null) {
    replyHandler=new Handler<AsyncResult<Message<Object>>>(){
      public void handle(      AsyncResult<Message<Object>> result){
        if (result.succeeded()) {
          Message message=result.result();
          checkAddAccceptedReplyAddress(message.replyAddress());
          deliverMessage(sock,replyAddress,message);
          info.handlerCount--;
        }
      }
    }
;
  }
 else {
    replyHandler=null;
  }
  if (log.isDebugEnabled()) {
    log.debug("Forwarding message to address " + address + " on event bus");
  }
  if (send) {
    eb.sendWithTimeout(address,body,replyTimeout,replyHandler);
    if (replyAddress != null) {
      info.handlerCount++;
    }
  }
 else {
    eb.publish(address,body);
  }
}
