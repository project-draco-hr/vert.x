{
  if (inbound && acceptedReplyAddresses.remove(address)) {
    return new Match(true,false);
  }
  List<JsonObject> matches=inbound ? inboundPermitted : outboundPermitted;
  for (  JsonObject matchHolder : matches) {
    String matchAddress=matchHolder.getString("address");
    String matchRegex;
    if (matchAddress == null) {
      matchRegex=matchHolder.getString("address_re");
    }
 else {
      matchRegex=null;
    }
    boolean addressOK;
    if (matchAddress == null) {
      if (matchRegex == null) {
        addressOK=true;
      }
 else {
        addressOK=regexMatches(matchRegex,address);
      }
    }
 else {
      addressOK=matchAddress.equals(address);
    }
    if (addressOK) {
      boolean matched=structureMatches(matchHolder.getObject("match"),body);
      if (matched) {
        Boolean b=matchHolder.getBoolean("requires_auth");
        return new Match(true,b != null && b);
      }
    }
  }
  return new Match(false,false);
}
