{
  Handler<Message<T>> handler=new Handler<Message<T>>(){
    public void handle(    Message reply){
      tu.checkThread();
      if (msg == null) {
        tu.azzert(reply.body() == null);
      }
 else {
        if (!(msg instanceof byte[])) {
          tu.azzert(msg.equals(reply.body()),"Expecting " + msg + " got "+ reply.body());
        }
 else {
          TestUtils.byteArraysEqual((byte[])msg,(byte[])reply.body());
        }
        if ((!isLocal() && !(msg instanceof Byte) && !(msg instanceof Boolean)) || (isLocal() && ((msg instanceof Buffer) || (msg instanceof byte[]) || (msg instanceof JsonObject)|| (msg instanceof JsonArray)))) {
          tu.azzert(msg != reply.body());
        }
 else {
          tu.azzert(msg == reply.body());
        }
      }
      eb.unregisterHandler(echoAddress(),this);
      tu.testComplete();
    }
  }
;
  return handler;
}
