{
  final String echoAddress=UUID.randomUUID().toString();
  vertx.sharedData().getMap("echoaddress").put("echoaddress",echoAddress);
  eb.registerHandler(echoAddress,new Handler<Message>(){
    boolean handled=false;
    public void handle(    final Message msg){
      tu.checkThread();
      tu.azzert(!handled);
      eb.unregisterHandler(echoAddress,this,new AsyncResultHandler<Void>(){
        @Override public void handle(        AsyncResult<Void> event){
          msg.reply(msg.body());
        }
      }
);
      handled=true;
    }
  }
,new AsyncResultHandler<Void>(){
    public void handle(    AsyncResult<Void> event){
      if (event.succeeded()) {
        tu.testComplete();
      }
 else {
        event.cause().printStackTrace();
        tu.azzert(false,"Failed to register");
      }
    }
  }
);
}
