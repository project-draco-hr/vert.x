{
  ch.write(buff,position,null,new java.nio.channels.CompletionHandler<Integer,Object>(){
    public void completed(    Integer bytesWritten,    Object attachment){
      long pos=position;
      if (buff.hasRemaining()) {
        pos+=bytesWritten;
        writeInternal(buff,pos,handler);
      }
 else {
        context.execute(new Runnable(){
          public void run(){
            writesOutstanding-=buff.limit();
            handler.handle(new DefaultFutureResult<Void>().setResult(null));
          }
        }
);
      }
    }
    public void failed(    Throwable exc,    Object attachment){
      if (exc instanceof Exception) {
        final Exception e=(Exception)exc;
        context.execute(new Runnable(){
          public void run(){
            handler.handle(new DefaultFutureResult<Void>().setResult(null));
          }
        }
);
      }
 else {
        log.error("Error occurred",exc);
      }
    }
  }
);
}
