{
  check();
  closed=true;
  if (writesOutstanding == 0) {
    doClose(handler);
  }
 else {
    closedDeferred=new Runnable(){
      public void run(){
        doClose(handler);
      }
    }
;
  }
}
