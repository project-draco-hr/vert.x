{
  long start=System.currentTimeMillis();
  long timeout=10000;
  while (true) {
    if (supplier.getAsBoolean()) {
      break;
    }
    Thread.sleep(10);
    long now=System.currentTimeMillis();
    if (now - start > timeout) {
      throw new IllegalStateException("Timed out");
    }
  }
}
