{
  Vertx vertx;
  if (clustered) {
    log.info("Starting clustering...");
    int clusterPort=args.getInt("-cluster-port");
    if (clusterPort == -1) {
      clusterPort=0;
    }
    String clusterHost=args.map.get("-cluster-host");
    if (clusterHost == null) {
      clusterHost=getDefaultAddress();
      if (clusterHost == null) {
        log.error("Unable to find a default network interface for clustering. Please specify one using -cluster-host");
        return null;
      }
 else {
        log.info("No cluster-host specified so using address " + clusterHost);
      }
    }
    vertx=Vertx.vertx(new VertxOptions().setClusterHost(clusterHost).setClusterPort(clusterPort).setClustered(true));
  }
 else {
    vertx=Vertx.vertx();
  }
  return vertx;
}
