{
  this.conn=conn;
  if (pendingMaxSize != -1) {
    conn.doSetWriteQueueMaxSize(pendingMaxSize);
  }
  if (pendingChunks != null) {
    ByteBuf pending=pendingChunks;
    pendingChunks=null;
    if (completed) {
      writeHeadWithContent(pending,true);
      conn.reportBytesWritten(written);
      if (respHandler != null) {
        conn.endRequest();
      }
    }
 else {
      writeHeadWithContent(pending,false);
    }
  }
 else {
    if (completed) {
      writeHeadWithContent(Unpooled.EMPTY_BUFFER,true);
      conn.reportBytesWritten(written);
      if (respHandler != null) {
        conn.endRequest();
      }
    }
 else {
      if (writeHead) {
        writeHead();
      }
    }
  }
}
