{
  conn=s.beginRequest(this);
  if (this.conn instanceof ClientConnection) {
    ClientConnection http1Conn=(ClientConnection)this.conn;
    this.metric=client.httpClientMetrics().requestBegin(http1Conn.metric(),http1Conn.localAddress(),http1Conn.remoteAddress(),this);
  }
  if (pendingMaxSize != -1) {
    this.conn.doSetWriteQueueMaxSize(pendingMaxSize);
  }
  if (pendingChunks != null) {
    ByteBuf pending=pendingChunks;
    pendingChunks=null;
    if (completed) {
      writeHeadWithContent(pending,true);
      s.reportBytesWritten(written);
      if (respHandler != null) {
        this.conn.endRequest();
      }
    }
 else {
      writeHeadWithContent(pending,false);
    }
  }
 else {
    if (completed) {
      writeHeadWithContent(Unpooled.EMPTY_BUFFER,true);
      s.reportBytesWritten(written);
      if (respHandler != null) {
        this.conn.endRequest();
      }
    }
 else {
      if (writeHead) {
        writeHead();
      }
    }
  }
}
