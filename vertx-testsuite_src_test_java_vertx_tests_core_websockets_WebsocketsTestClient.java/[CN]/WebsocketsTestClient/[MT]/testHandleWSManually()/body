{
  final String path="/some/path";
  final String message="here is some text data";
  server=vertx.createHttpServer().requestHandler(new Handler<HttpServerRequest>(){
    public void handle(    final HttpServerRequest req){
      NetSocket sock=getUpgradedNetSocket(req,path);
      Buffer buff=new Buffer();
      buff.appendByte((byte)129);
      buff.appendByte((byte)message.length());
      buff.appendString(message);
      sock.write(buff);
    }
  }
);
  server.listen(8080,"localhost",new AsyncResultHandler<HttpServer>(){
    @Override public void handle(    AsyncResult<HttpServer> ar){
      tu.azzert(ar.succeeded());
      client.connectWebsocket(path,new Handler<WebSocket>(){
        public void handle(        final WebSocket ws){
          ws.dataHandler(new Handler<Buffer>(){
            @Override public void handle(            Buffer buff){
              tu.azzert(message.equals(buff.toString("UTF-8")));
              tu.testComplete();
            }
          }
);
        }
      }
);
      client.exceptionHandler(new Handler<Throwable>(){
        @Override public void handle(        Throwable t){
          t.printStackTrace();
        }
      }
);
    }
  }
);
}
