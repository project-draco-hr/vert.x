{
  String json=JsonCodec.encode(pendingWrites.toArray());
  listener.sendFrame("a" + json);
  pendingWrites.clear();
  messagesSize=0;
  if (drainHandler != null && messagesSize <= maxQueueSize / 2) {
    Handler<Void> dh=drainHandler;
    drainHandler=null;
    dh.handle(null);
  }
}
