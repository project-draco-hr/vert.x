{
synchronized (conn) {
    checkEnded();
    endHandler=handler;
  }
  return this;
}
