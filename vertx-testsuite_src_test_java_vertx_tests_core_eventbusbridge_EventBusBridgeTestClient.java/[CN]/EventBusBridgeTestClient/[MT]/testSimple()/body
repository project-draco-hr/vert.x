{
  HttpClient client=vertx.createHttpClient().setPort(8080);
  client.connectWebsocket("/eventbus/websocket",new Handler<WebSocket>(){
    @Override public void handle(    WebSocket websocket){
      JsonObject msg=new JsonObject().putString("type","register").putString("address","someaddress");
      websocket.writeTextFrame(msg.encode());
      msg=new JsonObject().putString("type","send").putString("address","someaddress").putString("body","hello world");
      websocket.writeTextFrame(msg.encode());
      websocket.dataHandler(new Handler<Buffer>(){
        @Override public void handle(        Buffer buff){
          String msg=buff.toString();
          JsonObject received=new JsonObject(msg);
          tu.azzert(received.getString("body").equals("hello world"));
          tu.testComplete();
        }
      }
);
    }
  }
);
}
