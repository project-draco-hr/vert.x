{
synchronized (conn) {
    if (paused || pending.size() > 0) {
      pending.add(END);
    }
 else {
      handleEnd();
    }
  }
}
