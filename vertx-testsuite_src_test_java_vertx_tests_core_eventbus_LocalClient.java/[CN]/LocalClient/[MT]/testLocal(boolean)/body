{
  final int numHandlers=10;
  final String address=UUID.randomUUID().toString();
  final AtomicInteger count=new AtomicInteger(0);
  final Buffer buff=TestUtils.generateRandomBuffer(1000);
  for (int i=0; i < numHandlers; i++) {
    Handler<Message<Buffer>> handler=new Handler<Message<Buffer>>(){
      boolean handled;
      public void handle(      Message<Buffer> msg){
        tu.checkThread();
        tu.azzert(!handled);
        tu.azzert(TestUtils.buffersEqual(buff,msg.body()));
        int c=count.incrementAndGet();
        tu.azzert(c <= numHandlers);
        eb.unregisterHandler(address,this);
        if (c == numHandlers) {
          tu.testComplete();
        }
        handled=true;
      }
    }
;
    if (localMethod) {
      eb.registerLocalHandler(address,handler);
    }
 else {
      eb.registerHandler(address,handler);
    }
  }
  eb.publish(address,buff);
}
