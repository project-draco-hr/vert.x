{
  final long start=System.currentTimeMillis();
  final long timeout=500;
  String address="some-address";
  eb.registerHandler(address,new Handler<Message<String>>(){
    @Override public void handle(    final Message<String> message){
      vertx.setTimer(timeout * 2,new Handler<Long>(){
        @Override public void handle(        Long tid){
          message.reply("bar");
        }
      }
);
    }
  }
);
  eb.sendWithTimeout(address,"foo",timeout,new Handler<AsyncResult<Message<String>>>(){
    boolean replied;
    @Override public void handle(    AsyncResult<Message<String>> reply){
      tu.azzert(!replied);
      tu.azzert(reply.failed());
      tu.azzert(System.currentTimeMillis() - start >= timeout);
      vertx.setTimer(timeout * 2,new Handler<Long>(){
        @Override public void handle(        Long tid){
          tu.testComplete();
        }
      }
);
      replied=true;
    }
  }
);
}
