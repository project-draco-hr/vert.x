{
  conn.setCurrentRequest(this);
  this.conn=conn;
  if (pendingMaxSize != -1) {
    conn.doSetWriteQueueMaxSize(pendingMaxSize);
  }
  if (pendingChunks != null) {
    ByteBuf pending=pendingChunks;
    pendingChunks=null;
    if (completed) {
      writeHeadWithContent(pending,true);
      if (conn.metrics.isEnabled())       conn.metrics.bytesWritten(conn.remoteAddress(),written);
      conn.endRequest();
    }
 else {
      writeHeadWithContent(pending,false);
    }
  }
 else {
    if (completed) {
      writeHeadWithContent(Unpooled.EMPTY_BUFFER,true);
      if (conn.metrics.isEnabled())       conn.metrics.bytesWritten(conn.remoteAddress(),written);
      conn.endRequest();
    }
 else {
      if (writeHead) {
        writeHead();
      }
    }
  }
}
