{
  if (conn.metrics.isEnabled()) {
    HttpClientRequestBase req=this.req;
    if (req.exceptionOccurred) {
      conn.metrics.requestReset(req.metric());
    }
 else {
      conn.metrics.responseEnd(req.metric(),resp);
    }
  }
  ended=true;
  resp.handleEnd(null,new CaseInsensitiveHeaders());
}
