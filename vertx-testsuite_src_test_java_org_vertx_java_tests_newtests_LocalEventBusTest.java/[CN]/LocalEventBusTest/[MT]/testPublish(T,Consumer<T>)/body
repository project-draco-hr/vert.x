{
  AtomicInteger count=new AtomicInteger();
class MyHandler implements Handler<Message<T>> {
    @Override public void handle(    Message<T> msg){
      if (consumer == null) {
        assertEquals(val,msg.body());
      }
 else {
        consumer.accept(msg.body());
      }
      if (count.incrementAndGet() == 2) {
        testComplete();
      }
    }
  }
  eb.registerHandler(ADDRESS1,new MyHandler());
  eb.registerHandler(ADDRESS1,new MyHandler());
  eb.publish(ADDRESS1,(T)val);
  await();
}
