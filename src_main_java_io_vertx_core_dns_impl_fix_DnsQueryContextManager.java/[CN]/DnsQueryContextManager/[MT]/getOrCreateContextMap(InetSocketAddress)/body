{
synchronized (map) {
    final IntObjectMap<DnsQueryContext> contexts=map.get(nameServerAddr);
    if (contexts != null) {
      return contexts;
    }
    final IntObjectMap<DnsQueryContext> newContexts=new IntObjectHashMap<DnsQueryContext>();
    final InetAddress a=nameServerAddr.getAddress();
    final int port=nameServerAddr.getPort();
    map.put(nameServerAddr,newContexts);
    if (a instanceof Inet4Address) {
      final Inet4Address a4=(Inet4Address)a;
      if (a4.isLoopbackAddress()) {
        map.put(new InetSocketAddress(NetUtil.LOCALHOST6,port),newContexts);
      }
 else {
        map.put(new InetSocketAddress(toCompatAddress(a4),port),newContexts);
      }
    }
 else     if (a instanceof Inet6Address) {
      final Inet6Address a6=(Inet6Address)a;
      if (a6.isLoopbackAddress()) {
        map.put(new InetSocketAddress(NetUtil.LOCALHOST4,port),newContexts);
      }
 else       if (a6.isIPv4CompatibleAddress()) {
        map.put(new InetSocketAddress(toIPv4Address(a6),port),newContexts);
      }
    }
    return newContexts;
  }
}
