{
  BaseMessage bm;
  if (message instanceof String) {
    bm=new StringMessage(send,address,(String)message);
  }
 else   if (message instanceof Buffer) {
    bm=new BufferMessage(send,address,(Buffer)message);
  }
 else   if (message instanceof JsonObject) {
    bm=new JsonObjectMessage(send,address,(JsonObject)message);
  }
 else   if (message instanceof JsonArray) {
    bm=new JsonArrayMessage(send,address,(JsonArray)message);
  }
 else   if (message instanceof byte[]) {
    bm=new ByteArrayMessage(send,address,(byte[])message);
  }
 else   if (message instanceof Integer) {
    bm=new IntMessage(send,address,(Integer)message);
  }
 else   if (message instanceof Long) {
    bm=new LongMessage(send,address,(Long)message);
  }
 else   if (message instanceof Float) {
    bm=new FloatMessage(send,address,(Float)message);
  }
 else   if (message instanceof Double) {
    bm=new DoubleMessage(send,address,(Double)message);
  }
 else   if (message instanceof Boolean) {
    bm=new BooleanMessage(send,address,(Boolean)message);
  }
 else   if (message instanceof Short) {
    bm=new ShortMessage(send,address,(Short)message);
  }
 else   if (message instanceof Character) {
    bm=new CharacterMessage(send,address,(Character)message);
  }
 else   if (message instanceof Byte) {
    bm=new ByteMessage(send,address,(Byte)message);
  }
 else   if (message == null) {
    bm=new StringMessage(send,address,null);
  }
 else {
    String typeName=message.getClass().getName();
    MessageCodec<?> codec;
    if (clusterMgr != null) {
      codec=codecMap.get(typeName);
      if (codec == null) {
        throw new IllegalArgumentException("No codec registered for " + message.getClass() + " on the event bus: "+ message);
      }
    }
 else {
      codec=null;
    }
    @SuppressWarnings("unchecked") ObjectMessage<?> om=new ObjectMessage(send,address,message,typeName,codec);
    bm=om;
  }
  bm.bus=this;
  return bm;
}
