{
  if (connected) {
    socket.writeBuffer(message.encodeToWire());
  }
 else {
synchronized (this) {
      if (connected) {
        socket.writeBuffer(message.encodeToWire());
      }
 else {
        pending.add(message);
      }
    }
  }
}
