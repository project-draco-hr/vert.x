{
  if (connected) {
    socket.write(message.encodeToWire());
  }
 else {
synchronized (this) {
      if (connected) {
        socket.write(message.encodeToWire());
      }
 else {
        pending.add(message);
      }
    }
  }
}
