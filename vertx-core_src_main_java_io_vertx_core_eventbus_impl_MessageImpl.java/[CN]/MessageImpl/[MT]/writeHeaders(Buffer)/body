{
  if (headers != null && !headers.isEmpty()) {
    int headersLengthPos=buffer.getByteBuf().writerIndex();
    buffer.appendInt(0);
    buffer.appendInt(headers.size());
    List<Map.Entry<String,String>> entries=headers.entries();
    for (    Map.Entry<String,String> entry : entries) {
      writeString(buffer,entry.getKey());
      writeString(buffer,entry.getValue());
    }
    int headersEndPos=buffer.getByteBuf().writerIndex();
    buffer.setInt(headersLengthPos,headersEndPos - headersLengthPos);
  }
 else   if ((headers == null && headersPos != 0) || (headers != null && headersPos == 0)) {
    int length=wireBuffer.getInt(headersPos);
    buffer.appendInt(length);
    int numHeaders=wireBuffer.getInt(headersPos + 4);
    buffer.appendInt(numHeaders);
    byte[] rawHeaders=wireBuffer.getBytes(headersPos + 8,(headersPos) + length);
    buffer.appendBytes(rawHeaders);
  }
 else {
    buffer.appendInt(4);
  }
}
