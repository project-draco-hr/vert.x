{
  Vertx vertx=VertxFactory.newVertx();
  final EventBus eb=vertx.eventBus();
  final CountDownLatch latch=new CountDownLatch(1);
  eb.registerHandler("foo",new Handler<Message<String>>(){
    public void handle(    Message<String> msg){
      assert("bar".equals(msg.body()));
      eb.unregisterHandler("foo",this);
      latch.countDown();
    }
  }
);
  eb.send("foo","bar");
  assert(latch.await(5,TimeUnit.SECONDS));
  vertx.stop();
}
