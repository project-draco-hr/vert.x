{
  checkWritten();
  if (!headWritten) {
    prepareHeaders();
    FullHttpResponse resp;
    if (trailing != null) {
      resp=new AssembledFullHttpResponse(response,data,trailing.trailingHeaders());
    }
 else {
      resp=new AssembledFullHttpResponse(response,data);
    }
    channelFuture=conn.write(resp);
    headWritten=true;
  }
 else {
    if (!data.isReadable()) {
      if (trailing == null) {
        channelFuture=conn.write(LastHttpContent.EMPTY_LAST_CONTENT);
      }
 else {
        channelFuture=conn.write(trailing);
      }
    }
 else {
      LastHttpContent content;
      if (trailing != null) {
        content=new AssembledLastHttpContent(data,trailing.trailingHeaders());
      }
 else {
        content=new DefaultLastHttpContent(data,false);
      }
      channelFuture=conn.write(content);
    }
  }
  if (!keepAlive) {
    closeConnAfterWrite();
  }
  written=true;
  conn.responseComplete();
}
