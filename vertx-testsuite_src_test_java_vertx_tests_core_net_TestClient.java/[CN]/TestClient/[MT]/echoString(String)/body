{
  client.connect(1234,new AsyncResultHandler<NetSocket>(){
    public void handle(    AsyncResult<NetSocket> res){
      tu.checkThread();
      final String str=TestUtils.randomUnicodeString(1000);
      final Buffer sentBuff=enc == null ? new Buffer(str) : new Buffer(str,enc);
      final Buffer received=new Buffer();
      res.result().dataHandler(new Handler<Buffer>(){
        public void handle(        Buffer buffer){
          tu.checkThread();
          received.appendBuffer(buffer);
          if (received.length() == sentBuff.length()) {
            String rec=enc == null ? received.toString() : received.toString(enc);
            tu.azzert(str.equals(rec),"Expected:" + str + " Received:"+ rec);
            tu.testComplete();
          }
        }
      }
);
      if (enc == null) {
        res.result().write(str);
      }
 else {
        res.result().write(str,enc);
      }
    }
  }
);
}
