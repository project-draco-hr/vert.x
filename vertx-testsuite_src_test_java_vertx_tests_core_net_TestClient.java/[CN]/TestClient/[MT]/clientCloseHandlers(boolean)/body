{
  client.connect(1234,new AsyncResultHandler<NetSocket>(){
    public void handle(    AsyncResult<NetSocket> res){
      tu.checkThread();
      final AtomicInteger counter=new AtomicInteger(0);
      res.result().endHandler(new VoidHandler(){
        public void handle(){
          tu.checkThread();
          tu.azzert(counter.incrementAndGet() == 1);
        }
      }
);
      res.result().closeHandler(new VoidHandler(){
        public void handle(){
          tu.checkThread();
          tu.azzert(counter.incrementAndGet() == 2);
          tu.testComplete();
        }
      }
);
      if (closeFromClient) {
        res.result().close();
      }
    }
  }
);
}
