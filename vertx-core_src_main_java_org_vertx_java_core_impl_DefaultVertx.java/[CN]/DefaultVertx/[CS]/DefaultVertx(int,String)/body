{
  ClusterManagerFactory factory;
  String clusterManagerFactoryClassName=System.getProperty("vertx.clusterManagerFactory");
  if (clusterManagerFactoryClassName != null) {
    try {
      Class<?> clazz=Class.forName(clusterManagerFactoryClassName);
      factory=(ClusterManagerFactory)clazz.newInstance();
    }
 catch (    Exception e) {
      throw new IllegalStateException("Failed to instantiate " + clusterManagerFactoryClassName,e);
    }
  }
 else {
    ServiceLoader<ClusterManagerFactory> factories=ServiceLoader.load(ClusterManagerFactory.class);
    if (!factories.iterator().hasNext()) {
      throw new IllegalStateException("No ClusterManagerFactory instances found on classpath");
    }
    factory=factories.iterator().next();
  }
  this.clusterManager=factory.createClusterManager(this);
  this.clusterManager.join();
  this.eventBus=new DefaultEventBus(this,port,hostname,clusterManager);
}
